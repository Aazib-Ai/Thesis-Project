<!doctype html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Healthcare Analytics{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    {% block head %}{% endblock %}
</head>

<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="/" class="nav-brand">
                <i class="fas fa-shield-halved text-primary"></i> SecureHealth
            </a>

            <button class="mobile-menu-btn md:hidden" aria-label="Toggle menu">
                <i class="fas fa-bars"></i>
            </button>

            <div class="nav-links" id="navLinks">
                <a href="/" class="nav-link {% if request.path == '/' %}active{% endif %}">Home</a>
                <a href="/upload" class="nav-link {% if request.path == '/upload' %}active{% endif %}">Upload</a>
                <a href="/ui/analytics"
                    class="nav-link {% if request.path == '/ui/analytics' %}active{% endif %}">Analytics</a>
                <a href="/results" class="nav-link {% if request.path == '/results' %}active{% endif %}">Benchmarks</a>

                <div class="flex items-center gap-4 ml-4 border-l border-slate-700 pl-4">
                    <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                        <i class="fas fa-moon"></i>
                    </button>
                    <!-- Auth buttons - visible when not logged in -->
                    <div id="authSection" class="flex items-center gap-3">
                        <a href="/login" class="btn btn-sm btn-secondary">Sign In</a>
                        <a href="/register" class="btn btn-sm btn-primary">Sign Up</a>
                    </div>
                    <!-- User context - visible when logged in -->
                    <div id="userSection" class="hidden items-center gap-3">
                        <a href="/profile"
                            class="flex items-center gap-2 text-sm font-medium hover:text-primary transition-colors">
                            <div
                                class="w-8 h-8 rounded-full bg-primary-900/50 flex items-center justify-center text-primary">
                                <i class="fas fa-user"></i>
                            </div>
                            <span id="navUsername">User</span>
                        </a>
                        <button onclick="auth.logout()" class="btn btn-sm btn-secondary">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <footer class="py-8 border-t border-slate-800 mt-auto">
        <div class="container text-center text-muted text-sm">
            <p>&copy; 2024 SecureHealth. Privacy-Preserving Healthcare Analytics.</p>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/auth.js') }}"></script>
    <script src="{{ url_for('static', filename='js/notifications.js') }}"></script>
    <script>
        // Theme Toggle
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        const icon = themeToggle.querySelector('i');

        // Check saved theme
        const savedTheme = localStorage.getItem('theme') || 'dark';
        html.setAttribute('data-theme', savedTheme);
        if (savedTheme === 'light') {
            icon.classList.replace('fa-moon', 'fa-sun');
        }

        themeToggle.addEventListener('click', () => {
            if (html.getAttribute('data-theme') === 'dark') {
                html.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
                icon.classList.replace('fa-moon', 'fa-sun');
            } else {
                html.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                icon.classList.replace('fa-sun', 'fa-moon');
            }
        });

        // Mobile Menu
        const mobileBtn = document.querySelector('.mobile-menu-btn');
        const navLinks = document.querySelector('.nav-links');

        mobileBtn.addEventListener('click', () => {
            navLinks.classList.toggle('active');
            const menuIcon = mobileBtn.querySelector('i');
            if (navLinks.classList.contains('active')) {
                menuIcon.classList.replace('fa-bars', 'fa-times');
            } else {
                menuIcon.classList.replace('fa-times', 'fa-bars');
            }
        });

        // Auth State Update
        function updateAuthUI(isAuth) {
            const authSec = document.getElementById('authSection');
            const userSec = document.getElementById('userSection');
            const username = auth.getUser();

            if (isAuth && username) {
                authSec.classList.add('hidden');
                authSec.classList.remove('flex');
                userSec.classList.remove('hidden');
                userSec.classList.add('flex');
                document.getElementById('navUsername').textContent = username;
            } else {
                userSec.classList.add('hidden');
                userSec.classList.remove('flex');
                authSec.classList.remove('hidden');
                authSec.classList.add('flex');
            }
        }

        auth.subscribe(updateAuthUI);
        updateAuthUI(auth.isAuthenticated());
    </script>
    {% block scripts %}{% endblock %}
</body>

</html>